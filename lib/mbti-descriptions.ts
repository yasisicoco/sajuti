/**
 * MBTI 조합별 세부 설명 (축별 차이 반영)
 * 재미있고 자세한 톤으로 E/I, S/N, T/F, J/P 각 축 해석
 */

function matchCount(a: string, b: string): number {
  if (a.length !== 4 || b.length !== 4) return 0;
  let n = 0;
  for (let i = 0; i < 4; i++) if (a[i] === b[i]) n++;
  return n;
}

/** 일치 개수(0~4)에 따른 궁합 한 줄 요약 */
function getChemistryLine(mbtiA: string, mbtiB: string): string {
  const n = matchCount(mbtiA, mbtiB);
  const lines = [
    "완전히 다른 성향이라 처음엔 ‘이 사람 어디서 왔지?’ 싶을 수 있지만, 오히려 서로의 세계가 신기해서 끌리는 조합!",
    "한 가지만 맞아도 그 축에서 찰떡궁합. 나머지 차이는 오히려 말걸 거리가 되어요.",
    "반은 닮고 반은 달라서 이해도 되고 새로움도 있어요. 데이트할 때 지루할 틈이 없어요.",
    "세 축이 맞아서 말만 해도 통하는 느낌. ‘역시 너’ 싶은 순간이 자주 찾아옵니다.",
    "네 글자 다 맞는 흔치 않은 조합! 취향·말투·리듬까지 비슷해서 둘만의 유행어가 생기기 쉽답니다.",
  ];
  return lines[n] ?? lines[0];
}

/** E/I 축: 에너지 방향 */
function axisEI(mbtiA: string, mbtiB: string): string {
  const same = mbtiA[0] === mbtiB[0];
  if (same) {
    const bothE = mbtiA[0] === "E";
    return bothE
      ? "【에너지】 둘 다 외향이라 만나기만 하면 말이 터져 나와요. 약속 잡고, 사람 만나고, 밖에서 충전하는 스타일이 비슷해서 ‘나만 이런 줄 알았는데!’ 하며 찰떡. 다만 둘 다 에너지 쏟다가 동시에 방전되면 다음날 연락이 뜸해질 수 있으니, 가끔은 조용히 쉬는 날도 정해 두면 좋아요."
      : "【에너지】 둘 다 내향이라 만나도 조용히 있어도 편한 사이. ‘말 안 해도 됨’이 오히려 신뢰가 되는 타입. 데이트는 사람 적은 곳, 집에서 넷플릭스 같은 게 잘 맞고, 연락도 부담 없이 천천히 주고받을 수 있어요. 단, 누가 먼저 연락할지 미루다가 며칠이 지나갈 수 있으니, 가끔은 한 명이 먼저 ‘오늘 뭐해?’ 해 주면 든든해요.";
  }
  return "【에너지】 한쪽은 밖에서 충전하는 E, 한쪽은 안에서 충전하는 I라서 만남의 텐션과 휴식의 필요가 다릅니다. E인 쪽은 ‘자주 만나고 말 많이 하면 친해진다’고 느끼고, I인 쪽은 ‘많이 만나면 힘들다’고 느낄 수 있어요. 서로의 공간을 존중하는 게 핵심! I인 쪽이 혼자만의 시간을 가지는 건 상대를 싫어해서가 아니라는 걸, E인 쪽이 알아주면 금상첨화예요.";
}

/** S/N 축: 인식 방식 */
function axisSN(mbtiA: string, mbtiB: string): string {
  const same = mbtiA[1] === mbtiB[1];
  if (same) {
    const bothS = mbtiA[1] === "S";
    return bothS
      ? "【인식】 둘 다 감각(S)형이라 구체적이고 현실적인 이야기가 잘 통해요. ‘오늘 뭐 먹었어?’, ‘그거 어디서 샀어?’ 같은 디테일한 대화가 자연스럽고, 계획도 ‘언제, 어디서, 얼마’로 맞추기 쉬워요. 여행·데이트도 체크리스트대로 진행하는 걸 좋아하는 편이라, 예상치 못한 변수만 줄이면 스트레스가 적어요."
      : "【인식】 둘 다 직관(N)형이라 ‘뭔가 느낌이 와’, ‘이거 될 것 같아’ 같은 말을 서로 알아들어요. 아이디어나 상상 이야기를 나눠도 반응이 좋고, 미래나 가능성 얘기를 오래 할 수 있어요. 다만 둘 다 현실적인 디테일(시간, 돈, 장소)을 나중으로 미루다가 당일날 허둥대는 일이 있을 수 있으니, 중요한 건 한 명이 ‘그럼 구체적으로 언제 할까?’ 한 번만 짚어 주면 완벽해요.";
  }
  return "【인식】 한쪽은 감각(S)형으로 사실·경험·디테일을 중시하고, 한쪽은 직관(N)형으로 의미·가능성·큰 그림을 좋아해요. S인 쪽은 ‘그래서 결론이 뭐야?’, N인 쪽은 ‘그런데 그 뒤에 뭐가 있을 것 같지 않아?’ 하는 식으로 초점이 달라서, 대화할 때 ‘지금은 사실만 말할게’ / ‘지금은 아이디어만 말할게’ 하고 구간을 나누면 오해가 줄어들어요. 서로의 관점이 다르다는 걸 재미로 받아들이면, 한쪽은 발을 땅에 붙여 주고 한쪽은 날개를 달아 주는 보완 관계가 됩니다.";
}

/** T/F 축: 판단 방식 */
function axisTF(mbtiA: string, mbtiB: string): string {
  const same = mbtiA[2] === mbtiB[2];
  if (same) {
    const bothT = mbtiA[2] === "T";
    return bothT
      ? "【판단】 둘 다 사고(T)형이라 ‘이게 맞지’, ‘논리적으로 보면’ 같은 말이 잘 통해요. 갈등이 나도 원인·해결책을 나열하면 서로 이해하는 편이고, 감정보다 ‘왜 그랬는지’를 먼저 따지는 스타일이 비슷해요. 다만 둘 다 상대 감정을 챙기는 걸 뒤로 미루다가 ‘나한테 관심 없나?’ 싶을 수 있으니, 가끔은 ‘기분이 어때?’ 한마디만 해 줘도 관계가 훨씬 따뜻해져요."
      : "【판단】 둘 다 감정(F)형이라 ‘기분이 어때?’, ‘나도 그런 적 있어’ 같은 말에 공감이 잘 돼요. 말하지 않아도 분위기나 눈빛으로 느끼는 게 비슷하고, 결정할 때도 ‘우리 둘 다 괜찮아?’를 먼저 생각하는 편이에요. 다만 중요한 일에서 감정만으로 결정하다가 나중에 후회할 수 있으니, 큰일은 한 번만 ‘객관적으로 보면 어때?’ 하고 짚어 주는 사람이 있으면 좋아요.";
  }
  return "【판단】 한쪽은 사고(T)형으로 원인·논리·공정함을 중시하고, 한쪽은 감정(F)형으로 관계·분위기·상대 기분을 먼저 챙겨요. T인 쪽은 ‘해결이 중요해’라고 하고, F인 쪽은 ‘일단 위로가 먼저야’라고 느낄 수 있어요. 싸울 때 T는 ‘왜 그랬는지’ 설명을 원하고, F는 ‘나를 이해해 주는지’를 더 중요하게 느껴요. T인 쪽이 한 번만 ‘기분이 많이 안 좋았겠다’ 인정해 주고, F인 쪽이 한 번만 ‘그래서 네 논리는 이거지?’ 들어 주면 금방 풀리는 경우가 많아요.";
}

/** J/P 축: 생활 방식 */
function axisJP(mbtiA: string, mbtiB: string): string {
  const same = mbtiA[3] === mbtiB[3];
  if (same) {
    const bothJ = mbtiA[3] === "J";
    return bothJ
      ? "【생활】 둘 다 판단(J)형이라 ‘몇 시에, 어디서, 뭐 할지’ 미리 정해 두는 걸 좋아해요. 일정이 잡히면 안심하고, 약속 시간도 잘 지키는 편이라 서로 신뢰가 쌓여요. 다만 둘 다 고집이 있을 수 있어서, ‘이번엔 네가 정해’, ‘이번엔 내가 정해’ 하고 번갈아 가며 주도권을 넘기면 갈등이 줄어들어요."
      : "【생활】 둘 다 인식(P)형이라 ‘일단 만나고 생각하자’, ‘분위기 봐서 가자’가 잘 통해요. 즉흥 여행, 갑자기 바뀌는 계획도 스트레스 없이 받아들이는 편이라 함께 있을 때 유연하고 편해요. 다만 둘 다 미루다가 마감이나 예약을 놓칠 수 있으니, 중요한 건 캘린더에 한 번만 같이 넣어 두거나, 한 명이 ‘이거 이번 주 안에 하자’만 말해 주면 완벽해요.";
  }
  return "【생활】 한쪽은 판단(J)형으로 계획·정리·마감을 중요하게 생각하고, 한쪽은 인식(P)형으로 여유·변경·즉흥을 선호해요. J인 쪽은 ‘미리 정해 두면 안심’이고, P인 쪽은 ‘그때 가서 하면 되지’라서 만날 시간, 데이트 코스, 연락 빈도에서 조금씩 부딪힐 수 있어요. J인 쪽은 ‘가끔은 계획 없이 가는 날’ 하나만 허용해 주고, P인 쪽은 ‘진짜 중요한 건 한 번만 미리 잡자’ 해 주면 서로가 서로의 균형이 되어 줍니다.";
}

/**
 * MBTI 궁합 상세 설명 (재미있고 자세한 톤)
 */
export function getMbtiDescriptionDetailed(
  mbtiA: string,
  mbtiB: string,
): string {
  if (mbtiA.length !== 4 || mbtiB.length !== 4) return "MBTI를 확인해 주세요.";

  const chemistry = getChemistryLine(mbtiA, mbtiB);
  const sections = [
    chemistry,
    axisEI(mbtiA, mbtiB),
    axisSN(mbtiA, mbtiB),
    axisTF(mbtiA, mbtiB),
    axisJP(mbtiA, mbtiB),
  ];

  return sections.join("\n\n");
}

/** 일치 개수(0~4)별 짧은 라벨 */
export function getMbtiMatchLabel(matchCount: number): string {
  if (matchCount >= 4) return "네 가지 성향이 잘 맞아요.";
  if (matchCount >= 3) return "세 가지가 맞아 이해하기 쉬운 편이에요.";
  if (matchCount >= 2) return "반은 비슷하고 반은 달라 보완이 돼요.";
  if (matchCount >= 1) return "한 가지만 같아도 공통점을 키우면 좋아요.";
  return "완전히 다른 유형이라 차이를 재미로 보면 좋아요.";
}
